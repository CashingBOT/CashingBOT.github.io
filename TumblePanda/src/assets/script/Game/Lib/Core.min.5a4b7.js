!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).Core={})}(this,function(e){"use strict";var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,n)};function n(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}function i(e,t,n,i){var s,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;0<=a;a--)(s=e[a])&&(r=(o<3?s(r):3<o?s(t,n,r):s(t,n))||r);return 3<o&&r&&Object.defineProperty(t,n,r),r}function s(e,t,n,i){return new(n=n||Promise)(function(s,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(r,a)}c((i=i.apply(e,t||[])).next())})}function o(e,t){var n,i,s,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},r={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(s=2&r[0]?i.return:r[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,r[1])).done)return s;switch(i=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,i=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(s=0<(s=o.trys).length&&s[s.length-1])&&(6===r[0]||2===r[0])){o=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){o.label=r[1];break}if(6===r[0]&&o.label<s[1]){o.label=s[1],s=r;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(r);break}s[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(e){r=[6,e],i=0}finally{n=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}var r=(a.RES_TYPE_VIEW=0,a.RES_TYPE_SPRITE_FRAME=1,a.RES_TYPE_ATLAS=2,a.RES_TYPE_MP3=3,a.RES_TYPE_SPINE=4,a.RES_TYPE_JSON=5,a.RES_TYPE_ANIMATION=6,a.RES_TYPE_PREFAB=7,a.AGREEMENT_TYPE_REQUEST="request",a.AGREEMENT_TYPE_PUSH="push",a.AGREEMENT_TYPE_UDP="udp",a.SCREEN_STYLE_PORTRAIT=0,a.SCREEN_STYLE_LANDSCAPE=1,a.DEBUG_TYPE_0=0,a.DEBUG_TYPE_1=1,a.DEBUG_TYPE_2=2,a.DEBUG_LV_0=0,a.DEBUG_LV_1=1,a.DEBUG_LV_2=2,a);function a(){}var c=(u.version="",u.cacheKey="xxg",u.mainViewNum=1,u.logNum=20,u.netWarnTime=1500,u.debugType=0,u.debugLv=1,u.isOpenManyTouch=!1,u.screenStyle=0,u);function u(){}var l=(Object.defineProperty(h,"instance",{get:function(){return null==this._instance&&(this._instance=new h),this._instance},enumerable:!0,configurable:!0}),h.prototype.log=function(e){c.debugType!=r.DEBUG_TYPE_0&&(c.debugType==r.DEBUG_TYPE_1?cc.log(e):(this.list.push(e),this.send()))},h.prototype.error=function(e){c.debugType!=r.DEBUG_TYPE_0&&(c.debugType==r.DEBUG_TYPE_1?cc.error(e):(this.list.push("error\uff1a"+e),this.send()))},h.prototype.coreLog=function(e){c.debugType!=r.DEBUG_TYPE_0&&(c.debugType==r.DEBUG_TYPE_1?cc.log("core"+e):(this.list.push(e),this.send()))},h.prototype.coreError=function(e){c.debugType!=r.DEBUG_TYPE_0&&(c.debugType==r.DEBUG_TYPE_1?cc.error("core"+e):(this.list.push("error\uff1a"+e),this.send()))},h.prototype.send=function(){(c.debugType==r.DEBUG_TYPE_1||c.debugType==r.DEBUG_TYPE_2&&this.list.length>=c.logNum)&&(this.list=[])},h._instance=null,h);function h(){this.list=[]}function p(e){l.instance.coreError(e)}function d(e){l.instance.coreLog(e)}var f,g={ERROR_NO_LOCAL_MANIFEST:0,ERROR_DOWNLOAD_MANIFEST:1,NEW_VERSION_FOUND:2,ALREADY_UP_TO_DATE:3,UPDATE_PROGRESSION:4,ERROR_UPDATING:5,UPDATE_FINISHED:6,UPDATE_FAILED:7,ERROR_DECOMPRESS:8},v=cc._decorator,y=v.ccclass,m=v.property,E=v.menu,b=v.disallowMultiple,_=(n(N,f=cc.Component),N.prototype.onLoad=function(){cc.sys.isNative?(this.storagePath=(jsb.fileUtils?jsb.fileUtils.getWritablePath():"/")+"core-remote-asset",this.assetsManager=new jsb.AssetsManager("",this.storagePath,this.versionCompareHandle.bind(this)),this.assetsManager.setVerifyCallback(this.verifyCallBack.bind(this))):cc.log("core@HotUpdate\uff1a\u70ed\u66f4\u65b0\u7ec4\u4ef6\u53ea\u80fd\u5728\u539f\u751f\u5e73\u53f0\u751f\u6548\uff01")},N.prototype.setUrl=function(e){this.projectPath=(jsb.fileUtils?jsb.fileUtils.getWritablePath():"/")+"project.manifest";var t=this.getProjectJson();t.packageUrl=e,t.remoteManifestUrl=e+"project.manifest",t.remoteVersionUrl=e+"version.manifest",jsb.fileUtils.writeStringToFile(JSON.stringify(t),this.projectPath)},N.prototype.getBuildVersion=function(){return this.getProjectJson().version},N.prototype.checkCb=function(e){var t=null,n=null,i=null,s="",o="";switch(e.getEventCode()){case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:t=g.ERROR_NO_LOCAL_MANIFEST;break;case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:t=g.ERROR_DOWNLOAD_MANIFEST,i=e.getMessage();break;case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:t=g.ALREADY_UP_TO_DATE;break;case jsb.EventAssetsManager.NEW_VERSION_FOUND:if(this.assetsManager.getTotalBytes()<=0){d("@HotUpdate\uff1a\u68c0\u6d4b\u5230\u6700\u65b0\u7248\u672c\u4f46\u662f\u6ca1\u6709\u66f4\u65b0\u5185\u5bb9"),t=g.ALREADY_UP_TO_DATE;break}t=g.NEW_VERSION_FOUND,n=this.sizeConversion(this.assetsManager.getTotalBytes()),s=this.currentV,o=this.latestV}t&&(this.checkCallback&&this.checkCallback({state:t,size:n,msg:i,currentV:s,latestV:o}),this.assetsManager.setEventCallback(null),this.updating=!1)},N.prototype.checkUpdate=function(){var e=this;if(!this.updating)return new Promise(function(t){var n;if(e.project||t({state:g.ERROR_NO_LOCAL_MANIFEST,size:null,msg:"\u6ca1\u6709\u5728\u7f16\u8f91\u5668\u4e2d\u62d6\u62fd\u672c\u5730\u66f4\u65b0\u914d\u7f6e",currentV:"",latestV:""}),e.assetsManager.getState()===jsb.AssetsManager.State.UNINITED&&(n=e.projectPath?e.projectPath:e.project.nativeUrl,cc.loader.md5Pipe&&(n=cc.loader.md5Pipe.transformURL(n)),e.assetsManager.loadLocalManifest(n)),!e.assetsManager.getLocalManifest()||!e.assetsManager.getLocalManifest().isLoaded())return t({state:g.ERROR_NO_LOCAL_MANIFEST,size:null,msg:"\u627e\u4e0d\u5230\u672c\u5730\u66f4\u65b0\u914d\u7f6e",currentV:"",latestV:""}),void(e.updating=!1);e.checkCallback=t,e.assetsManager.setEventCallback(e.checkCb.bind(e)),e.assetsManager.checkUpdate(),e.updating=!0})},N.prototype.hotUpdate=function(){var e;this.assetsManager&&!this.updating&&(this.assetsManager.setEventCallback(this.updateCb.bind(this)),this.assetsManager.getState()===jsb.AssetsManager.State.UNINITED&&(e=this.projectPath?this.projectPath:this.project.nativeUrl,cc.loader.md5Pipe&&(e=cc.loader.md5Pipe.transformURL(e)),this.assetsManager.loadLocalManifest(e)),this.assetsManager.update(),this.updating=!0)},N.prototype.updateCb=function(e){var t,n,i=!1,s=!1,o={state:null,percent:null,percentByFile:null,downloadedFiles:null,totalFiles:null,downloadedBytes:null,totalBytes:null,msg:null,assetId:null};switch(e.getEventCode()){case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:o.state=g.ERROR_NO_LOCAL_MANIFEST,o.msg="\u627e\u4e0d\u5230\u672c\u5730\u66f4\u65b0\u914d\u7f6e\uff0c\u8df3\u8fc7\u70ed\u66f4\u65b0",s=!0;break;case jsb.EventAssetsManager.UPDATE_PROGRESSION:o.state=g.UPDATE_PROGRESSION,o.percent=e.getPercent(),o.percentByFile=e.getPercentByFile(),o.downloadedFiles=e.getDownloadedFiles(),o.totalFiles=e.getTotalFiles(),o.downloadedBytes=e.getTotalBytes();var r=e.getMessage();r&&(o.msg="\u66f4\u65b0\u6587\u4ef6\uff1a"+r);break;case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:o.state=g.ERROR_DOWNLOAD_MANIFEST,o.msg="\u4e0b\u8f7d\u66f4\u65b0\u914d\u7f6e\u51fa\u9519",s=!0;break;case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:o.state=g.ALREADY_UP_TO_DATE,o.msg="\u5df2\u7ecf\u662f\u6700\u65b0\u7248\u672c",s=!0;break;case jsb.EventAssetsManager.UPDATE_FINISHED:o.state=g.UPDATE_FINISHED,o.msg="\u66f4\u65b0\u5b8c\u6210",i=!0;break;case jsb.EventAssetsManager.UPDATE_FAILED:o.state=g.UPDATE_FAILED,o.msg=e.getMessage(),this.updating=!1;break;case jsb.EventAssetsManager.ERROR_UPDATING:o.state=g.ERROR_UPDATING,o.assetId=e.getAssetId(),o.msg=e.getMessage();break;case jsb.EventAssetsManager.ERROR_DECOMPRESS:o.state=g.ERROR_DECOMPRESS,o.msg=e.getMessage()}this.updateCallback.emit([o]),s&&(this.assetsManager.setEventCallback(null),this.updating=!1),i&&(this.assetsManager.setEventCallback(null),t=jsb.fileUtils.getOriginalSearchPaths(),n=this.assetsManager.getLocalManifest().getSearchPaths(),Array.prototype.unshift.apply(t,n),cc.sys.localStorage.setItem("HotUpdateSearchPaths",JSON.stringify(t)),jsb.fileUtils.setSearchPaths(t),cc.audioEngine.stopAll(),cc.game.restart())},N.prototype.versionCompareHandle=function(e,t){d("@HotUpdate\uff1a\u68c0\u67e5\u662f\u5426\u9700\u8981\u66f4\u65b0 \u5f53\u524d\u7248\u672c\uff1a"+e+", \u6700\u65b0\u7248\u672c\uff1a "+t),this.currentV=e,this.latestV=t;for(var n=e.split("."),i=t.split("."),s=0;s<n.length;++s){var o=parseInt(n[s]),r=parseInt(i[s]||0);if(o!==r)return o-r}return i.length>n.length?-1:0},N.prototype.verifyCallBack=function(e,t){return t.compressed,t.md5,t.path,t.size,!0},N.prototype.sizeConversion=function(e){var t=e/8;if(t<=1024)return t.toFixed(0)+"B";var n=t/1024;if(n<=1024)return n.toFixed(0)+"KB";var i=n/1024;if(i<=1024)return i.toFixed(0)+"MB";var s=i/1024;return s<=1024?s.toFixed(0)+"GB":void 0},N.prototype.replaceUrl=function(e,t){var n=jsb.fileUtils.getStringFromFile(e);(n=JSON.parse(n)).packageUrl=t,n.remoteManifestUrl=t+"project.manifest",n.remoteVersionUrl=t+"version.manifest",jsb.fileUtils.writeStringToFile(JSON.stringify(n),e)},N.prototype.getProjectJson=function(){var e,t,n=null,i=null,s=jsb.fileUtils.getWritablePath()+"core-remote-asset";return jsb.fileUtils.isDirectoryExist(s)&&(i=s+"/project.manifest",cc.loader.md5Pipe&&(i=cc.loader.md5Pipe.transformURL(i)),(t=jsb.fileUtils.getStringFromFile(i))&&(n=JSON.parse(t))),i=this.project.nativeUrl,cc.loader.md5Pipe&&(i=cc.loader.md5Pipe.transformURL(i)),e=JSON.parse(jsb.fileUtils.getStringFromFile(i)),!n||e.version>n.version?e:n},i([m({type:cc.Asset})],N.prototype,"project",void 0),i([m(cc.Component.EventHandler)],N.prototype,"updateCallback",void 0),N=i([y("HotUpdate"),b(),E("\u6838\u5fc3\u5e93\u7ec4\u4ef6/\u70ed\u66f4\u65b0")],N));function N(){var e=f.call(this)||this;return e.assetsManager=null,e.storagePath="",e.updating=!1,e.project=null,e.checkCallback=null,e.updateCallback=new cc.Component.EventHandler,e.currentV=null,e.latestV=null,e.url=null,e.projectPath=null,e}var S=(O.timePoor=0,O.isGame=!1,O.isIos=!0,O.isAppPlatform=!1,O.isPcWebPlatform=!1,O.isMobile=!0,O.isNative=!1,O.isNet=!0,O.browser="",O.unitType="",O.baseLogicNum=0,O.nodeLogicNum=0,O);function O(){}var L=(Object.defineProperty(C,"instance",{get:function(){return null==this._instance&&(this._instance=new C),this._instance},enumerable:!0,configurable:!0}),C.prototype.init=function(){var e,t,n,i,s,o,r,a,c,u;S.isNative=cc.sys.isNative,cc.sys.isNative?cc.sys.OS_IOS==cc.sys.os?S.isIos=!0:cc.sys.OS_ANDROID==cc.sys.os&&(S.isIos=!1):(t=(e=navigator.userAgent.toLowerCase()).match(/iphone/i),n=e.match(/ipad/i),i=e.match(/ipod/i),s=e.match(/android/i),o=e.match(/mobile/i),r=e.match(/chrome/i),a=e.match(/mqqbrowser/i),c=e.match(/ucbrowser/),u=e.match(/safari/i),S.isMobile=!!o,t||n||i?S.isIos=!0:s&&(S.isIos=!1),r?S.browser="chrome":a?S.browser="qqBrowser":c?S.browser="ucBrowser":u&&(S.browser="safari")),this.judgeUnitType(),this.screenAdapter()},C.prototype.judgeUnitType=function(){var e=cc.find("Canvas"),t=e.width,n=e.height;c.screenStyle==r.SCREEN_STYLE_PORTRAIT?2<=n/t&&(S.unitType="Iphone X"):c.screenStyle==r.SCREEN_STYLE_LANDSCAPE&&2<=t/n&&(S.unitType="Iphone X")},C.prototype.screenAdapter=function(){"Iphone X"==S.unitType&&(c.screenStyle==r.SCREEN_STYLE_PORTRAIT?(this.leftOffsetPx=0,this.rightOffsetPx=0,this.onOffsetPx=50,this.downOffsetPx=50):c.screenStyle==r.SCREEN_STYLE_LANDSCAPE&&(this.leftOffsetPx=50,this.rightOffsetPx=50,this.onOffsetPx=0,this.downOffsetPx=0))},C.prototype.getOffset=function(){return{top:this.onOffsetPx,bottom:this.downOffsetPx,left:this.leftOffsetPx,right:this.rightOffsetPx}},C._instance=null,C);function C(){this.leftOffsetPx=0,this.rightOffsetPx=0,this.onOffsetPx=0,this.downOffsetPx=0}var T,R=cc._decorator,w=R.ccclass,M=(R.property,R.menu),I=R.disallowMultiple,P=R.requireComponent,A=(n(k,T=cc.Component),k.prototype.onLoad=function(){var e=this.node.getComponent(cc.Widget),t=L.instance.getOffset();e.top=t.top,e.bottom=t.bottom,e.left=t.left,e.right=t.right},k=i([w("ViewAdaptation"),I(),P(cc.Widget),M("\u6838\u5fc3\u5e93\u7ec4\u4ef6/\u754c\u9762\u9002\u914d")],k));function k(){return T.call(this)||this}var D=(V.prototype.watch=function(e,t){var n=("on_"+e+"_change").toUpperCase();return null==this.coreListeners[n]&&(this.coreListeners[n]={}),this.coreHandleIndex++,this.coreListeners[n][""+this.coreHandleIndex]=t,this.touch(e),this.coreHandleIndex},V.prototype.unwatch=function(e){var t=""+e;for(var n in this.coreListeners)if(this.coreListeners[n].hasOwnProperty(t))return void delete this.coreListeners[n][t]},V.prototype.touch=function(e,t,n){var i=("on_"+e+"_change").toUpperCase();if(t=t||this[e],n=n||this[e],null!=this.coreListeners[i])for(var s in this.coreListeners[i])(0,this.coreListeners[i][s])(t,n)},V);function V(){this.coreListeners={},this.coreHandleIndex=0}var U=(j.shineUpon=function(e){for(var t=e.key,n={},i=0,s=t.length;i<s;i++)n[t[i]]=i;return n},j.setTableData=function(e){this.table=e},j.getText=function(e){var t=this.table.lang[e];return t?t[this.shineUpon(this.table.lang).FieldContent]:"@"+e},j.table=null,j);function j(){}var F=(B.getCacheDataObj=function(){return{token:null,music:1,sound:1,userName:null}},B.getResDataObj=function(){return{name:null,type:null,path:null,obj:null}},B.getWsMessageObj=function(){return{uri:null,version:null,timestamp:null,attach:null,action:null,data:null}},B);function B(){}var x=(H.createNodeSprite=function(e,t,n,i){var s=i?new cc.Node(i):new cc.Node;return s.parent=n,s.addComponent(cc.Sprite).spriteFrame=e,s},H.createNodeLabel=function(e,t,n,i,s,o){var r=o?new cc.Node(o):new cc.Node;r.color=t,r.parent=s;var a=r.addComponent(cc.Label);return a.fontSize=n,a.lineHeight=i,a.string=e,a.horizontalAlign=cc.Label.HorizontalAlign.CENTER,a.verticalAlign=cc.Label.VerticalAlign.CENTER,r},H.bindButton=function(e,t,n,i){var s=e.addComponent(cc.Button);return i||(s.interactable=!0,s.enableAutoGrayEffect=!0,s.transition=cc.Button.Transition.SCALE,s.duration=.1,s.zoomScale=.9),s.node.on("click",t,n),s},H);function H(){}var q=(Y.getCurrentTimeStamp=function(){return Math.floor((new Date).valueOf())-S.timePoor},Y.goldFormatting=function(e){if(1e4<=e&&e<1e8){var t=(e/1e4).toFixed(3),n=t.indexOf(".");return t.substring(0,n+2+1)+U.getText("common007")}if(1e8<=e){var i=(e/1e8).toFixed(3),s=i.indexOf(".");return i.substring(0,s+2+1)+U.getText("common008")}return e.toFixed(2)},Y.getYearMonthDay=function(e){var t=new Date(e);return t.getFullYear()+"-"+(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-"+(t.getDate()<10?"0"+t.getDate():t.getDate())},Y.getWhenMinuteSecond=function(e){var t=new Date(e);return(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":"+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds())},Y.secondToTime=function(e){var t="";if(3600<e)return d("@CommonFun\uff1a\u4f20\u5165\u7684\u6700\u5927\u503c\u53ea\u652f\u63013600\u79d2\u4ee5\u5185"),null;var n=Math.floor(e/60);9<n?t+=n:n<1?(n=0,t+="00"):t+="0"+n;var i=e-60*n;return(t+=":")+(9<i?i:"0"+i)},Y.attributeCharacterFill=function(e,t){if(!e)return"";if(!e.length)return e;if(e){for(var n="",i=0;i<e.length;i++)"%"==e[i]&&0<=parseInt(e[i+1])&&parseInt(e[i+1])<=9?(n+=t[parseInt(e[i+1])],i++):n+=e[i];return n}},Y.splitStringSemicolon=function(e){return e&&""!=e?e.split(":"):[]},Y.splitStringComma=function(e){return e&&""!=e?(e=e.toString()).split(","):[]},Y.splitStringSet=function(e){if(!e||""==e)return[];for(var t=Y.splitStringComma(e),n=[],i=0,s=t.length;i<s;i++)n.push(Y.splitStringSemicolon(t[i]));return n},Y.setCacheData=function(e,t){localStorage.setItem(e,t)},Y.getCacheData=function(e){return localStorage.getItem(e)},Y.removeCacheData=function(e){return localStorage.removeItem(e)},Y.cleanConnectionData=function(){var e=this.getCacheJsonData();e.token=null,Y.setCacheJsonData(e)},Y.getCacheJsonData=function(){var e,t=Y.getCacheData(c.cacheKey);if(t&&"string"==typeof t)try{e=JSON.parse(t)}catch(t){e=F.getCacheDataObj(),Y.setCacheData(c.cacheKey,JSON.stringify(e))}else e=F.getCacheDataObj(),Y.setCacheData(c.cacheKey,JSON.stringify(e));return e},Y.setCacheJsonData=function(e){this.setCacheData(c.cacheKey,JSON.stringify(e))},Y.getUrlJumpData=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=location.search.substr(1).match(t);return null!=n?unescape(n[2]):null},Y.binaryBitmapNum=function(e){for(var t=e.toString(),n="",i={0:"01",1:"23",2:"45",3:"67",4:"89",5:":;",6:"<=",7:">?",8:"@A",9:"BC",".":"D","+":"EF","-":"GH"},s=0;s<t.length;s++)n+=i[t[s]];return n},Y.openViewAction=function(e,t){e.setScale(.5),e.runAction(cc.sequence(cc.scaleTo(.15,1),cc.callFunc(function(){t&&t()})))},Y.vec2ToWordVec2=function(e,t){var n=null;t=t||cc.v2(0,0),n=e.convertToWorldSpaceAR(t);var i=cc.find("Canvas");return n.x=n.x-i.width/2,n.y=n.y-i.height/2,n},Y.wordVec2ToVec2=function(e,t){t=t||cc.v2(0,0);var n=e.convertToNodeSpaceAR(t),i=cc.find("Canvas");return n.x=n.x+i.width/2,n.y=n.y+i.height/2,n},Y.getRandom=function(e,t){if(t){var n=t-e;return Math.floor(Math.random()*n)+e}return Math.floor(Math.random()*e)},Y.errPrompt=function(e){var t=cc.find("Canvas"),n=cc.color(255,0,0),i=x.createNodeLabel(e,n,24,30,t);i.runAction(cc.sequence(cc.delayTime(2),cc.callFunc(function(){i.destroy()})))},Y.strToClipboard=function(e){var t=e+"",n=document.createElement("textarea");n.value=t,n.setAttribute("readonly",""),n.style.position="absolute",n.style.left="-9999px",n.style.fontSize="12pt";var i=getSelection(),s=null;0<i.rangeCount&&(s=i.getRangeAt(0)),document.body.appendChild(n),n.select(),n.selectionStart=0,n.selectionEnd=t.length;var o=!1;try{o=document.execCommand("copy")}catch(e){}return document.body.removeChild(n),s&&(i.removeAllRanges(),i.addRange(s)),o},Y.getViewMainLogic=function(e){var t=e.name.replace("View","Logic");return e.getComponent(t)},Y.getPrefabMainLogic=function(e){var t=e.name.replace("Component","Logic");return e.getComponent(t)},Y.reboot=function(){cc.sys.isNative&&(cc.audioEngine.stopAll(),cc.game.restart())},Y);function Y(){}var W=(Object.defineProperty(G,"instance",{get:function(){return null==this._instance&&(this._instance=new G),this._instance},enumerable:!0,configurable:!0}),G.prototype.onNetPush=function(e,t,n){this.descriptorOnNetPushMap[e]||(this.descriptorOnNetPushMap[e]=[]),this.descriptorOnNetPushMap[e].push({uri:t,funName:n})},G.prototype.getNetPushContrast=function(e){return this.descriptorOnNetPushMap[e]},G.prototype.onEvent=function(e,t,n){this.descriptorOnEventMap[e]||(this.descriptorOnEventMap[e]=[]),this.descriptorOnEventMap[e].push({eventName:t,funName:n})},G.prototype.getEventContrast=function(e){return this.descriptorOnEventMap[e]},G.prototype.onCode=function(e,t,n){this.descriptorOnCodeMap[e]||(this.descriptorOnCodeMap[e]=[]),this.descriptorOnCodeMap[e].push({code:t,funName:n})},G.prototype.getCodeContrast=function(e){return this.descriptorOnCodeMap[e]},G.prototype.onModule=function(e,t,n){this.descriptorOnModuleMap[e]||(this.descriptorOnModuleMap[e]=[]),this.descriptorOnModuleMap[e].push({obj:t,property:n})},G.prototype.getModuleContrast=function(e){return this.descriptorOnModuleMap[e]},G.prototype.onInstance=function(e,t,n){this.descriptorOnInstanceMap[e]||(this.descriptorOnInstanceMap[e]=[]),this.descriptorOnInstanceMap[e].push({class:t,property:n})},G.prototype.getInstanceContrast=function(e){return this.descriptorOnInstanceMap[e]},G._instance=null,G);function G(){this.descriptorOnNetPushMap={},this.descriptorOnEventMap={},this.descriptorOnCodeMap={},this.descriptorOnModuleMap={},this.descriptorOnInstanceMap={}}var J=0;function z(){return++J}var K=(Object.defineProperty(Q,"instance",{get:function(){return null==this._instance&&(this._instance=new Q),this._instance},enumerable:!0,configurable:!0}),Q.prototype.encode=function(e){var t,n,i,s,o,r,a,c="",u=0;for(e=this.utf8Encode(e);u<e.length;)s=(t=e.charCodeAt(u++))>>2,o=(3&t)<<4|(n=e.charCodeAt(u++))>>4,r=(15&n)<<2|(i=e.charCodeAt(u++))>>6,a=63&i,isNaN(n)?r=a=64:isNaN(i)&&(a=64),c=c+this.keyStr.charAt(s)+this.keyStr.charAt(o)+this.keyStr.charAt(r)+this.keyStr.charAt(a);return c},Q.prototype.decode=function(e){var t,n,i,s,o,r,a="",c=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<e.length;)t=this.keyStr.indexOf(e.charAt(c++))<<2|(s=this.keyStr.indexOf(e.charAt(c++)))>>4,n=(15&s)<<4|(o=this.keyStr.indexOf(e.charAt(c++)))>>2,i=(3&o)<<6|(r=this.keyStr.indexOf(e.charAt(c++))),a+=String.fromCharCode(t),64!=o&&(a+=String.fromCharCode(n)),64!=r&&(a+=String.fromCharCode(i));return this.utf8Decode(a)},Q.prototype.utf8Encode=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var i=e.charCodeAt(n);i<128?t+=String.fromCharCode(i):(127<i&&i<2048?t+=String.fromCharCode(i>>6|192):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128)),t+=String.fromCharCode(63&i|128))}return t},Q.prototype.utf8Decode=function(e){for(var t="",n=0,i=0,s=0,o=0;n<e.length;)(i=e.charCodeAt(n))<128?(t+=String.fromCharCode(i),n++):191<i&&i<224?(s=e.charCodeAt(n+1),t+=String.fromCharCode((31&i)<<6|63&s),n+=2):(s=e.charCodeAt(n+1),o=e.charCodeAt(n+2),t+=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o),n+=3);return t},Q._instance=null,Q);function Q(){this.keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}var X=(Z.getResObj=function(e){var t=this.coreResMap[e];if(!t)return null;var n=F.getResDataObj();return n.name=e,n.type=t.type,n.path=t.path,n},Z.getViewResList=function(e){var t=[],n=this.getViewResObj(e);t.push(n);var i=this.coreViewMap[e];if(i)for(var s=0;s<i.length;s++){var o=this.getResObj(i[s]);o?t.push(o):p("@CoreResList\uff1a\b\b\b\u89c6\u56fe<"+e+">\u5185\u914d\u7f6e\u7684\u8d44\u6e90<"+i[s]+">\u6ca1\u6709\u627e\u5230\u914d\u7f6e")}return t},Z.getViewResObj=function(e){var t=this.corePreloadControl[e];if(t){var n=F.getResDataObj();return n.name=e,n.path=t.path,n.type=r.RES_TYPE_VIEW,n}return null},Z.register=function(e,t,n,i){for(var s in e)this.corePreloadControl[s]=e[s];var o;for(s=0;s<t.length;s++){o=!0;for(var r=0;r<this.coreInitList.length;r++)t[s]==this.coreInitList[r]&&(o=!1);o&&this.coreInitList.push(t[s])}for(var s in n)this.coreViewMap[s]=n[s];for(var s in i)this.coreResMap[s]=i[s]},Z.corePreloadControl={},Z.coreInitList=[],Z.coreViewMap={},Z.coreResMap={config:{type:r.RES_TYPE_JSON,path:"Config/config"},table:{type:r.RES_TYPE_JSON,path:"Config/tableConfig"}},Z);function Z(){}var $=(Object.defineProperty(ee,"instance",{get:function(){return null==this._instance&&(this._instance=new ee),this._instance},enumerable:!0,configurable:!0}),ee.prototype.setCanvasDependAssets=function(){},ee.prototype.setInitRes=function(e){this.initResMap[e.name]=e},ee.prototype.removeInitRes=function(e){var t;this.initResMap[e]&&(t=this.initResMap[e],delete this.initResMap[e],this.releaseRes(t))},ee.prototype.getRes=function(e,t){return s(this,void 0,void 0,function(){var n,i;return o(this,function(s){switch(s.label){case 0:return(n=this.initResMap[e])?[2,n]:(n=this.resMap[t])&&n[e]?[2,n[e]]:(i=X.getResObj(e))?[4,this.loadRes(i)]:[3,2];case 1:return(i=s.sent())&&this.setRes(t,i),[2,i];case 2:return p("\b@ResManage\br\uff1a\u627e\u4e0d\u5230\u8d44\u6e90\u540d\u4e3a<"+e+">\u7684\u8d44\u6e90\u914d\u7f6e"),[2,null]}})})},ee.prototype.setRes=function(e,t){this.resMap[e]||(this.resMap[e]={}),this.resMap[e][t.name]=t},ee.prototype.releaseViewRes=function(e){var t=this.resMap[e];if(t){for(var n in t){var i=t[n];delete t[n],this.releaseRes(i)}delete this.resMap[e]}},ee.prototype.loadRes=function(e){return new Promise(function(t){var n=null;e.type==r.RES_TYPE_ATLAS?n=cc.SpriteAtlas:e.type==r.RES_TYPE_SPINE?n=sp.SkeletonData:e.type==r.RES_TYPE_ANIMATION?n=cc.AnimationClip:e.type==r.RES_TYPE_SPRITE_FRAME?n=cc.SpriteFrame:e.type==r.RES_TYPE_PREFAB&&(n=cc.Prefab),cc.resources.load(e.path,n,function(e,t,n){},function(n,i){n?(p("\b@ResManage\br\uff1a\u8d44\u6e90<"+e.name+">\u52a0\u8f7d\u5931\u8d25  "+n),t(null)):(e.obj=i,t(e))})})},ee.prototype.isRelease=function(e){if(this.initResMap[e])return!1;for(var t in this.resMap)if(this.resMap[t][e])return!1;return!0},ee.prototype.releaseRes=function(e){this.isRelease(e.name)&&cc.assetManager.releaseAsset(e.obj)},ee.prototype.logCacheRes=function(){console.log("@ResManager\uff1a\u521d\u59cb\u5316\u8d44\u6e90"),console.log(this.initResMap),console.log("@ResManager\uff1a\u7f13\u5b58\u8d44\u6e90\uff1a"),console.log(this.resMap)},ee.prototype.logCacheNum=function(){d("@ResManager\uff1a\u8d44\u6e90\u7f13\u5b58\u6570<"+cc.assetManager.assets.count+">")},ee.prototype.logCache=function(){console.log(cc.assetManager.assets._map)},ee._instance=null,ee);function ee(){this.initResMap={},this.resMap={}}var te=(Object.defineProperty(ne,"instance",{get:function(){return null==this._instance&&(this._instance=new ne),this._instance},enumerable:!0,configurable:!0}),ne.prototype.onDescriptor=function(e,t,n,i){for(var s=0;s<this.funNameList.length;s++)if(this.eventKeyList[s]==i&&t==this.thatList[s]&&n==this.instanceIdList[s])return p("\b@EventManage\uff1a\u76f8\u540c\u65b9\u6cd5\u4e0d\u80fd\u591a\u6b21\u6ce8\u518c\uff01"),!1;return this.eventKeyList.push(e),this.funNameList.push(i),this.funList.push(null),this.thatList.push(t),this.instanceIdList.push(n),!0},ne.prototype.on=function(e,t,n){for(var i=0;i<this.funNameList.length;i++)if(n==this.thatList[i]&&t==this.funList[i])return void p("\b@EventManage\uff1a\u76f8\u540c\u65b9\u6cd5\u4e0d\u80fd\u591a\u6b21\u6ce8\u518c\uff01");this.eventKeyList.push(e),this.funNameList.push(null),this.funList.push(t),this.thatList.push(n),this.instanceIdList.push(null)},ne.prototype.offDescriptor=function(e){for(var t=0;t<this.eventKeyList.length;t++)e==this.instanceIdList[t]&&(this.eventKeyList.splice(t,1),this.funNameList.splice(t,1),this.thatList.splice(t,1),this.instanceIdList.splice(t,1),this.funList.splice(t,1),t--)},ne.prototype.off=function(e,t){for(var n=0;n<this.eventKeyList.length;n++)e==this.eventKeyList[n]&&t==this.funList[n]&&null==this.instanceIdList[n]&&(this.eventKeyList.splice(n,1),this.funNameList.splice(n,1),this.thatList.splice(n,1),this.instanceIdList.splice(n,1),this.funList.splice(n,1),n--)},ne.prototype.event=function(e,t){for(var n=0;n<this.eventKeyList.length;n++)this.eventKeyList[n]==e&&(this.funList[n]?this.funList[n].call(this.thatList[n],t):this.thatList[n][this.funNameList[n]](t))},ne._instance=null,ne);function ne(){this.eventKeyList=[],this.funNameList=[],this.thatList=[],this.instanceIdList=[],this.funList=[]}var ie=(se.CORE_ON_HIDE="core_on_hide",se.CORE_ON_SHOW="core_on_show",se.CORE_NET_DISCONNECT="core_net_disconnect",se.CORE_NET_CONNECTION="core_net_connection",se.CORE_WS_DISCONNECT="core_ws_disconnect",se.CORE_WS_RECONNECTION_FAILUE="core_ws_reconnection_failue",se.CORE_WS_RECONNECTION_SUCCES="core_ws_reconnection_success",se.CORE_ON_DELAY_WARN="core_on_delayWarn",se.CORE_WS_NOT_CONNECTION="core_ws_not_connection",se.CORE_ON_CAPTURE_CODE="core_on_capture_code",se);function se(){}var oe=(re.CORE_ERROR_CODE_NONE=0,re.CORE_NO_URL=404,re.CORE_SERVER_ERROR=500,re.CORE_HTTP_SERVER_ABNORMAL=503,re.CORE_NOT_NET=801,re.CORE_WS_NOT_NET=802,re);function re(){}var ae=(ce.init=function(){this.protocol=window.xxgBuf},ce.isProtocol=function(){return!!this.protocol},ce.pack=function(e,t,n){var i,s=this.protocol[e].encode(t).finish(),o=this.charsToByte(e),r=o.length,a=this.tagLen+this.msgTypeLen+this.routeLen+this.serialNumLen+this.codeLen+this.secondTimeLen+this.millisecondTimeLen+this.nameLen+r+s.length,c=0,u=new Uint8Array(a);switch(u.set(this.numberToByte(this.protocolTag,this.tagLen),c),c+=this.tagLen,n){case"request":i=this.msgTypeRequest;break;case"udp":i=this.msgTypeUdp}return u.set(this.numberToByte(i,this.msgTypeLen),c),c+=this.msgTypeLen,u.set(this.numberToByte(this.route,this.routeLen),c),c+=this.routeLen,u.set(this.numberToByte(this.getSerialNum(),this.serialNumLen),c),c+=this.serialNumLen,u.set(this.numberToByte(0,this.codeLen),c),c+=this.codeLen,u.set(this.numberToByte(0,this.secondTimeLen),c),c+=this.secondTimeLen,u.set(this.numberToByte(0,this.millisecondTimeLen),c),c+=this.millisecondTimeLen,u.set(this.numberToByte(r,this.nameLen),c),c+=this.nameLen,u.set(o,c),c+=r,u.set(s,c),u},ce.unpack=function(e){var t=new Uint8Array(e),n=0,i=this.byteToNumber(t.subarray(n,this.tagLen),this.tagLen);if(n+=this.tagLen,i!=this.protocolTag)return null;var s,o=this.byteToNumber(t.subarray(n,n+this.msgTypeLen),this.msgTypeLen);switch(n+=this.msgTypeLen,o){case this.msgTypePush:s="push";break;case this.msgTypeRequest:s="request"}var r=this.byteToNumber(t.subarray(n,n+this.routeLen),this.routeLen);n+=this.routeLen,this.byteToNumber(t.subarray(n,n+this.serialNumLen),this.serialNumLen),n+=this.serialNumLen;var a=this.byteToNumber(t.subarray(n,n+this.codeLen),this.codeLen);n+=this.codeLen;var c=this.byteToNumber(t.subarray(n,n+this.secondTimeLen),this.secondTimeLen);n+=this.secondTimeLen;var u=this.byteToNumber(t.subarray(n,n+this.millisecondTimeLen),this.millisecondTimeLen);n+=this.millisecondTimeLen;var l=this.byteToNumber(t.subarray(n,n+this.nameLen),this.nameLen);n+=this.nameLen;var h=t.subarray(n,n+l);n+=l;var p=this.byteToString(h);this.route=r;var d=t.subarray(n),f=null;return a==oe.CORE_ERROR_CODE_NONE&&this.protocol[p]&&(f=this.protocol[p].decode(d,d.length)),{uri:p,data:f,action:s,code:a,timestamp:1e3*c+u}},ce.getSerialNum=function(){return this.curSerialNum>=this.serialNumMax&&(this.curSerialNum=1),this.curSerialNum++},ce.numberToByte=function(e,t){void 0===t&&(t=4);for(var n=new Uint8Array(t),i=0;i<t;i++)n[t-i-1]=e>>8*i&255;return n},ce.byteToNumber=function(e,t){void 0===t&&(t=4);for(var n=0,i=0;i<t;i++)n|=e[i]<<8*(t-i-1);return n},ce.charsToByte=function(e){for(var t=0,n=e.length,i=new Uint8Array(n);t<n;t++)i[t]=e.charCodeAt(t);return i},ce.byteToString=function(e){return String.fromCharCode.apply(null,e)},ce.route=0,ce.curSerialNum=1,ce.protocolTag=45,ce.protocol=null,ce.tagLen=1,ce.msgTypeLen=1,ce.routeLen=1,ce.serialNumLen=2,ce.serialNumMax=Math.pow(2,16)-1,ce.codeLen=2,ce.secondTimeLen=4,ce.millisecondTimeLen=4,ce.nameLen=1,ce.msgTypePush=0,ce.msgTypeRequest=1,ce.msgTypeUdp=2,ce);function ce(){}var ue,le=cc._decorator,he=le.ccclass,pe=le.property,de=le.menu,fe=le.disallowMultiple,ge=le.requireComponent,ve=(n(ye,ue=cc.Component),ye.prototype.onEnable=function(){var e=this;this.loadNode.active=!1,this.tag&&(this.timeout=setTimeout(function(){e.loadNode.active=!0,e.loadNode.runAction(cc.repeatForever(cc.rotateBy(1,360)))},500))},ye.prototype.onDisable=function(){clearTimeout(this.timeout),this.loadNode.active=!1,this.tag=!0},ye.prototype.setTag=function(e){this.tag=e},i([pe(cc.Node)],ye.prototype,"loadNode",void 0),ye=i([he("NetShield"),fe(),de("\u6838\u5fc3\u5e93\u7ec4\u4ef6/\u901a\u8baf\u5c4f\u853d"),ge(cc.BlockInputEvents)],ye));function ye(){var e=ue.call(this)||this;return e.timeout=null,e.loadNode=null,e.tag=!0,e}var me,Ee=cc._decorator,be=Ee.ccclass,_e=Ee.property,Ne=Ee.menu,Se=Ee.disallowMultiple,Oe=Ee.requireComponent,Le=(n(Ce,me=cc.Component),Ce.prototype.onLoad=function(){this.mask.active=!1,this.skeleton.active=!1},Ce.prototype.showLoadProgress=function(){this.lb.string="Load\uff1a0%",this.mask.active=!0,this.skeleton.active=!0},Ce.prototype.setProgress=function(e,t){var n=this;e<0&&(e=0),100<e&&(e=100),this.interval&&clearInterval(this.interval),this.interval=setInterval(function(){n.progress>=e?clearInterval(n.interval):(n.progress++,n.showProgress(n.progress),100<=n.progress&&(t&&t(),clearInterval(n.interval),n.progress=0))},10)},Ce.prototype.showProgress=function(e){this.lb.string="Load\uff1a"+Math.ceil(e)+" %",100<=e&&(this.mask.active=!1,this.skeleton.active=!1,this.node.active=!1)},i([_e(cc.Node)],Ce.prototype,"mask",void 0),i([_e(cc.Node)],Ce.prototype,"skeleton",void 0),i([_e(cc.Label)],Ce.prototype,"lb",void 0),Ce=i([be("DistributedLoad"),Se(),Ne("\u6838\u5fc3\u5e93\u7ec4\u4ef6/\u5206\u5e03\u5f0f\u52a0\u8f7d"),Oe(cc.BlockInputEvents)],Ce));function Ce(){var e=me.call(this)||this;return e.mask=null,e.skeleton=null,e.lb=null,e.interval=null,e.progress=0,e}var Te=(Object.defineProperty(Re,"instance",{get:function(){return null==this._instance&&(this._instance=new Re),this._instance},enumerable:!0,configurable:!0}),Re.prototype.setCanvasObj=function(e){this.canvas=e,this.shieldView=this.canvas.getChildByName("ShieldView"),this.shieldView.zIndex=9999,this.resLoadView=this.canvas.getChildByName("LoadView"),this.resLoadView.zIndex=9997,S.isNative&&(this.resLoadView.active=!1)},Re.prototype.getCanvasObj=function(){return this.canvas},Re.prototype.openShieldView=function(e){this.shieldView.getComponent(ve).setTag(e),this.shieldView.active=!0},Re.prototype.closeShieldView=function(){this.shieldView.active=!1},Re.prototype.openResLoadView=function(e){this.resLoadView.active=!0,S.isNative||e&&this.resLoadView.getComponent(Le).showLoadProgress()},Re.prototype.closeResLoadView=function(){this.resLoadView.getComponent(Le).showProgress(100)},Re.prototype.loadView=function(e,t){return s(this,void 0,void 0,function(){var n=this;return o(this,function(i){return[2,new Promise(function(i){return s(n,void 0,void 0,function(){var n,s,r,a,c,u,l,h,d,f,g,v=this;return o(this,function(o){switch(o.label){case 0:return n=!this.loadViewMap[e],s=this.resLoadView.getComponent(Le),(r=X.getViewResObj(e))?[4,$.instance.loadRes(r)]:(p("\u627e\u4e0d\u5230\u89c6\u56fe<"+e+">\u7684\u76f8\u5173\u914d\u7f6e\uff01"),i(null),[2]);case 1:if(!(a=o.sent()).obj)return p("@ViewManage\uff1a\u52a0\u8f7d<"+e+">\u89c6\u56fe\u5931\u8d25\uff01"),i(null),[2];if(c=cc.instantiate(a.obj),s.setProgress(20),u=a.name+"_"+S.nodeLogicNum++,$.instance.setRes(u,a),(l=q.getViewMainLogic(c)).coreSetNodeId(u),l.init(t),h=X.coreViewMap[c.name],S.isNative||!n)return i(c),[2];if(!(n&&h&&h.length))return[3,5];d=h.length,f=1,g=0,o.label=2;case 2:return g<h.length?[4,$.instance.getRes(h[g],u)]:[3,5];case 3:o.sent(),s.setProgress(f/d*78+20),f++,o.label=4;case 4:return g++,[3,2];case 5:return s.setProgress(100,function(){v.addLoadViewTag(e),i(c)}),[2]}})})})]})})},Re.prototype.addLoadViewTag=function(e){this.loadViewMap[e]=!0},Re.prototype.logViewLoadHistory=function(){d("@viewManage\uff1a\u5df2\u7ecf\u52a0\u8f7d\u8fc7\u7684\u89c6\u56fe\uff1a"+JSON.stringify(this.loadViewMap))},Re.prototype.openView=function(e,t,n){return s(this,void 0,void 0,function(){var i,s,r;return o(this,function(o){switch(o.label){case 0:return i=(new Date).getTime(),s=!this.loadViewMap[e],S.isGame&&!S.isNative&&this.openResLoadView(s),[4,this.loadView(e,t)];case 1:return(r=o.sent())?(r.zIndex=n||this.zIndex,this.canvas.addChild(r),S.isGame&&this.closeResLoadView(),this.zIndex++,this.pushNode(r,n),this.retrieveView(),d("@ViewManager\uff1a\u6253\u5f00\u89c6\u56fe<"+r.name+"> \u8017\u65f6<"+((new Date).getTime()-i)+">\u6beb\u79d2"),$.instance.logCacheNum(),[2,!0]):(this.closeResLoadView(),[2,!1])}})})},Re.prototype.closeView=function(e){var t;if(e){var n=void 0,i=null;for(n=this.viewNameStack.length-1;0<=n;n--)if(this.viewNameStack[n]==e){i=n;break}if(null==i)return void p("@ViewManage\uff1a\u5f53\u524d\u6253\u5f00\u7684\u89c6\u56fe\u5806\u6808\u4e2d\u6ca1\u6709<"+e+">\u89c6\u56fe");this.closeRetrieveView(i),t=this.viewStack[i],this.viewStack.splice(i,1),this.viewNameStack.splice(i,1),this.topPointer--}else if(this.closeRetrieveView(this.topPointer-1),!(t=this.popNode()))return void p("@ViewManage\uff1a\u89c6\u56fe\u5806\u6808\u4e2d\u6ca1\u6709\u89c6\u56fe");t&&(this.zIndex--,t.destroy(),d("@ViewManager\uff1a\u5173\u95ed\u89c6\u56fe"+t.name),$.instance.logCacheNum(),cc.sys.garbageCollect())},Re.prototype.getChildViewObj=function(e){return this.canvas.getChildByName(e)},Re.prototype.getScriptObj=function(e,t){var n=this.getChildViewObj(e);if(n){var i=n.getComponent(t);if(i)return i;p("@ViewManage\uff1a\u627e\u4e0d\u5230<"+t+">\u811a\u672c\uff01")}else p("@ViewManage\uff1a\u627e\u4e0d\u5230<"+e+">\u89c6\u56fe\uff01")},Re.prototype.goToMainView=function(){for(;this.topPointer>c.mainViewNum;)this.closeView()},Re.prototype.retrieveView=function(){if(1<this.topPointer){var e=this.topPointer-1,t=this.getTagToViewStyle(e),n=void 0,i=void 0;if(0==t)return;if(1==t)for(n=e-1;0<=n;n--)(i=this.viewStack[n]).active&&(i.active=!1)}},Re.prototype.closeRetrieveView=function(e){if(!(e<=0))if(e+1==this.topPointer){--e,(i=this.viewStack[e]).active=!0;for(var t=void 0,n=e;0<n;n--)if(0==(t=this.getTagToViewStyle(n)))(i=this.viewStack[n-1])&&i.isValid&&0==i.active&&(i.active=!0);else if(1==t)return}else{n=void 0,t=void 0;var i=void 0;for(n=this.topPointer-1;0<=n;n--)if(1==(t=this.getTagToViewStyle(n)))(i=this.viewStack[n-1])&&i.isValid&&0==i.active&&(i.active=!0);else if(1==t)return}},Re.prototype.getTagToViewStyle=function(e){var t=this.viewStack[e];return q.getViewMainLogic(t).style},Re.prototype.pushNode=function(e,t){if(e.active=!0,t){for(var n=this.viewStack.length-1;t<=n;n--)this.viewNameStack[n+1]=this.viewNameStack[n],this.viewStack[n].zIndex++,this.viewStack[n+1]=this.viewStack[n];this.viewNameStack[t]=e.name,this.viewStack[t]=e}else this.viewNameStack.push(e.name),this.viewStack.push(e);this.topPointer++},Re.prototype.popNode=function(){if(this.topPointer){var e=this.topPointer-1;this.closeRetrieveView(e);var t=this.viewStack[e];return t.destroy(),this.viewStack.splice(e,1),this.viewNameStack.splice(e,1),this.topPointer--,t}},Re._instance=null,Re);function Re(){this.viewStack=[],this.viewNameStack=[],this.topPointer=0,this.zIndex=0,this.loadViewMap={},this.isOpenSystemPopupWindow=!1}var we=(Object.defineProperty(Me,"instance",{get:function(){return null==this._instance&&(this._instance=new Me),this._instance},enumerable:!0,configurable:!0}),Me.prototype.registerMusicManage=function(){this.cacheData=q.getCacheJsonData(),this.musicNum=this.cacheData.music,this.soundNum=this.cacheData.sound,this.setAllMusicVolume(this.cacheData.music),this.setAllSoundVolume(this.cacheData.sound)},Me.prototype.setAllMusicVolume=function(e){this.musicNum=e,cc.audioEngine.setMusicVolume(e),this.updateCacheData()},Me.prototype.setAllSoundVolume=function(e){this.soundNum=e,cc.audioEngine.setEffectsVolume(e),this.updateCacheData()},Me.prototype.setAllMute=function(){this.muteMusic=cc.audioEngine.getMusicVolume(),this.muteSound=cc.audioEngine.getEffectsVolume(),cc.audioEngine.setMusicVolume(0),cc.audioEngine.setEffectsVolume(0),this.isMute=!0},Me.prototype.setAllNoMute=function(){this.isMute&&(cc.audioEngine.setMusicVolume(this.muteMusic),cc.audioEngine.setEffectsVolume(this.muteSound)),this.isMute=!1},Me.prototype.playMusic=function(e){cc.audioEngine.playMusic(e,!0)},Me.prototype.playSound=function(e){this.soundNum&&cc.audioEngine.playEffect(e,!1)},Me.prototype.getMusicNum=function(){return this.musicNum},Me.prototype.getSoundNum=function(){return this.soundNum},Me.prototype.updateCacheData=function(){this.cacheData.music=this.musicNum,this.cacheData.sound=this.soundNum,q.setCacheJsonData(this.cacheData)},Me._instance=null,Me);function Me(){this.isMute=!1,this.muteMusic=null,this.muteSound=null}var Ie,Pe=(n(Ae,Ie=cc.Component),Ae.prototype.onLoad=function(){return s(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return console.log("\u524d\u7aef\u6846\u67b6\u7248\u672c\uff1a3.0.24"),this.init(),[4,this.loadApplication()];case 1:return e.sent()?[4,this.preload()]:(d("@ApplicationLogic\uff1a\u9879\u76ee\u542f\u52a8\u88ab\u963b\u65ad"),[2]);case 2:return e.sent(),[4,this.startApplication()];case 3:return e.sent(),this.setLoadProgress(100),[2]}})})},Ae.prototype.coreRegisterRes=function(e){var t=new e;X.register(t.preloadControl,t.initList,t.viewMap,t.resMap)},Ae.prototype.coreRegisterConfig=function(e){for(var t in e)c[t]=e[t]},Ae.prototype.init=function(){cc.game.on(cc.game.EVENT_HIDE,function(){te.instance.event(ie.CORE_ON_HIDE)}),cc.game.on(cc.game.EVENT_SHOW,function(){te.instance.event(ie.CORE_ON_SHOW)}),cc.sys.isNative||(window.addEventListener("offline",function(){S.isNet=!1,te.instance.event(ie.CORE_NET_DISCONNECT)}),window.addEventListener("online",function(){S.isNet=!0,te.instance.event(ie.CORE_NET_CONNECTION)})),cc.macro.ENABLE_MULTI_TOUCH=c.isOpenManyTouch,ae.init(),L.instance.init(),Te.instance.setCanvasObj(cc.find("Canvas")),we.instance.registerMusicManage()},Ae.prototype.preload=function(){return s(this,void 0,void 0,function(){var e,t,n,i;return o(this,function(s){switch(s.label){case 0:if($.instance.logCacheNum(),!X.coreInitList)return[3,4];n=void 0,t=X.coreInitList.length,i=0,s.label=1;case 1:return i<t?[4,$.instance.loadRes(X.getResObj(X.coreInitList[i]))]:[3,4];case 2:n=s.sent(),$.instance.setInitRes(n),this.setLoadProgress(parseInt((40*(i+1)/t).toFixed(0))),s.label=3;case 3:return i++,[3,1];case 4:if(!X.corePreloadControl)return[3,8];for(i in e=[],X.corePreloadControl)X.corePreloadControl[i].isLoad&&(e=e.concat(X.getViewResList(i)));t=e.length,n=void 0,i=0,s.label=5;case 5:return i<t?[4,$.instance.loadRes(e[i])]:[3,8];case 6:(n=s.sent()).type==r.RES_TYPE_VIEW&&Te.instance.addLoadViewTag(n.name),$.instance.releaseRes(n),this.setLoadProgress(40+parseInt((50*(i+1)/t).toFixed(0))),s.label=7;case 7:return i++,[3,5];case 8:return $.instance.logCacheNum(),[2]}})})},Ae.prototype.loadApplication=function(){return s(this,void 0,void 0,function(){return o(this,function(e){return[2,!0]})})},Ae.prototype.startApplication=function(){return null},Ae.prototype.setLoadProgress=function(e){e<0&&(e=0),100<=e&&(e=100,S.isGame=!0),this.initLoadProgress(e)},Ae.prototype.initLoadProgress=function(e){},Ae);function Ae(){var e=Ie.call(this)||this;return e.httpUrl=null,e.token=null,e}var ke=(Object.defineProperty(De,"instance",{get:function(){return null==this._instance&&(this._instance=new De),this._instance},enumerable:!0,configurable:!0}),De.prototype.setPushData=function(e,t){this.messageDistribute(e,t)},De.prototype.messageDistribute=function(e,t){for(var n=0;n<this.uriList.length;n++)this.uriList[n]==e&&this.thatList[n][this.funNameList[n]](t)},De.prototype.on=function(e,t,n,i){for(var s=0;s<this.funNameList.length;s++)if(this.uriList[s]==i&&t==this.thatList[s]&&n==this.instanceIdList[s])return p("\b@NetPushManager\uff1a\u76f8\u540c\u65b9\u6cd5\u4e0d\u80fd\u591a\u6b21\u6ce8\u518c\uff01"),!1;return this.uriList.push(e),this.funNameList.push(i),this.thatList.push(t),this.instanceIdList.push(n),!0},De.prototype.off=function(e){for(var t=0;t<this.uriList.length;t++)e==this.instanceIdList[t]&&(this.uriList.splice(t,1),this.funNameList.splice(t,1),this.thatList.splice(t,1),this.instanceIdList.splice(t,1),t--)},De._instance=null,De);function De(){this.uriList=[],this.funNameList=[],this.thatList=[],this.instanceIdList=[]}var Ve=(Object.defineProperty(Ue,"instance",{get:function(){return null==this._instance&&(this._instance=new Ue),this._instance},enumerable:!0,configurable:!0}),Ue.prototype.checkCode=function(e){this.codeDistribute(e)},Ue.prototype.codeDistribute=function(e){for(var t=!0,n=0;n<this.codeList.length;n++)this.codeList[n]==e&&(this.thatList[n][this.funNameList[n]](e),t=!1);t&&te.instance.event(ie.CORE_ON_CAPTURE_CODE,e)},Ue.prototype.on=function(e,t,n,i){return this.codeList.push(e),this.funNameList.push(i),this.thatList.push(t),this.instanceIdList.push(n),!0},Ue.prototype.off=function(e){for(var t=0;t<this.codeList.length;t++)e==this.instanceIdList[t]&&(this.codeList.splice(t,1),this.funNameList.splice(t,1),this.thatList.splice(t,1),this.instanceIdList.splice(t,1),t--)},Ue._instance=null,Ue);function Ue(){this.codeList=[],this.funNameList=[],this.thatList=[],this.instanceIdList=[]}var je=(Fe.prototype.setTimeout=function(e){var t=this,n=null,i=new Promise(function(i){n=setTimeout(function(){i(),t.clearTimeout(n)},e),t.timeOutList.push(n)});return{id:n,promise:i}},Fe.prototype.clearTimeout=function(e){for(var t=0;t<this.timeOutList.length;t++)if(e==this.timeOutList[t])return clearTimeout(e),void this.timeOutList.splice(t,1)},Fe.prototype.setInterval=function(e,t){var n=setInterval(function(){e()},t);return this.intervalList.push(n),n},Fe.prototype.clearInterval=function(e){for(var t=0;t<this.intervalList.length;t++)if(e==this.intervalList[t])return clearInterval(e),void this.intervalList.splice(t,1)},Fe.prototype.clearAll=function(){for(var e=0;e<this.timeOutList.length;e++)clearTimeout(this.timeOutList[e]);for(this.timeOutList=[],e=0;e<this.intervalList.length;e++)clearInterval(this.intervalList[e]);this.intervalList=[]},Fe);function Fe(){this.timeOutList=[],this.intervalList=[]}var Be=(xe.prototype.coreOnPushFun=function(){var e=this.__proto__.classId;if(e){var t=W.instance.getNetPushContrast(e);if(t)for(var n=0;n<t.length;n++)ke.instance.on(t[n].uri,this,this.coreInstanceId,t[n].funName)}},xe.prototype.coreOnCodeFun=function(){var e=this.__proto__.classId;if(e){var t=W.instance.getCodeContrast(e);if(t)for(var n=0;n<t.length;n++)Ve.instance.on(t[n].code,this,this.coreInstanceId,t[n].funName)}},xe.prototype.coreOnEventFun=function(){var e=this.__proto__.classId;if(e){var t=W.instance.getEventContrast(e);if(t)for(var n=0;n<t.length;n++)te.instance.onDescriptor(t[n].eventName,this,this.coreInstanceId,t[n].funName)}},xe.prototype.coreOnModule=function(){var e=this.__proto__.classId;if(e){var t=W.instance.getModuleContrast(e);if(t)for(var n=0;n<t.length;n++)t[n].obj==je&&(this.coreTimerModule=new je,this[t[n].property]=this.coreTimerModule)}},xe.prototype.coreGetInstanceId=function(){return this.coreInstanceId},xe.prototype.destructor=function(){te.instance.offDescriptor(this.coreInstanceId),ke.instance.off(this.coreInstanceId),Ve.instance.off(this.coreInstanceId),this.coreTimerModule&&this.coreTimerModule.clearAll(),this.coreDestructor()},xe.prototype.coreDestructor=function(){},xe);function xe(){this.coreInstanceId="baseLogic",this.coreTimerModule=null,this.coreInstanceId+="_"+S.baseLogicNum++,this.coreOnPushFun(),this.coreOnEventFun(),this.coreOnCodeFun(),this.coreOnModule()}var He=(qe.prototype.setAllMusicVolume=function(e){e<0||1<e?p("@Audio\uff1a\u97f3\u91cf\u53d6\u503c\u8303\u56f40~1"):we.instance.setAllMusicVolume(e)},qe.prototype.setAllSoundVolume=function(e){e<0||1<e?p("@Audio\uff1a\u97f3\u6548\u53d6\u503c\u8303\u56f40~1"):we.instance.setAllSoundVolume(e)},qe.prototype.setAllMute=function(){we.instance.setAllMute()},qe.prototype.setAllNoMute=function(){we.instance.setAllNoMute()},qe.prototype.playMusic=function(e){return s(this,void 0,void 0,function(){var t,n;return o(this,function(i){switch(i.label){case 0:return t=null,"string"!=typeof e?[3,2]:[4,$.instance.getRes(e,this.coreViewId)];case 1:return(n=i.sent())&&n.obj?(t=n.obj,[3,3]):[2,!1];case 2:t=e,i.label=3;case 3:return we.instance.playMusic(t),[2,!0]}})})},qe.prototype.playSound=function(e){return s(this,void 0,void 0,function(){var t,n;return o(this,function(i){switch(i.label){case 0:return t=null,"string"!=typeof e?[3,2]:[4,$.instance.getRes(e,this.coreViewId)];case 1:return(n=i.sent())&&n.obj?(t=n.obj,[3,3]):[2,!1];case 2:t=e,i.label=3;case 3:return we.instance.playSound(t),[2,!0]}})})},qe.prototype.getMusicNum=function(){return we.instance.getMusicNum()},qe.prototype.getSoundNum=function(){return we.instance.getSoundNum()},qe.prototype.updateCacheData=function(){we.instance.updateCacheData()},qe);function qe(e){this.coreViewId=e}var Ye=(We.prototype.getRes=function(e){return $.instance.getRes(e,this.coreViewId)},We.prototype.getPrefab=function(e){return s(this,void 0,void 0,function(){var t,n,i;return o(this,function(s){switch(s.label){case 0:return(t=X.getResObj(e)).type!=r.RES_TYPE_PREFAB?(p("@Res\uff1a\u52a0\u8f7d\u7684\u8d44\u6e90\u4e0d\u662fPrefab"),[2,null]):[4,$.instance.loadRes(t)];case 1:return(t=s.sent()).obj?(n=cc.instantiate(t.obj),i=n.name+"_"+S.nodeLogicNum++,$.instance.setRes(i,t),q.getPrefabMainLogic(n).coreSetNodeId(i),[2,n]):(p("@Res\uff1a\u52a0\u8f7d<"+e+">Prefab\u5931\u8d25\uff01"),[2,null])}})})},We.prototype.loadExternal=function(e){return new Promise(function(t,n){cc.assetManager.loadRemote(e,function(i,s){return i?(p("@ResManage\uff1a\u5916\u90e8\u8d44\u6e90\u52a0\u8f7d\u9519\u8bef"+e),p(i),void n()):void t(s)})})},We);function We(e){this.coreViewId=e}var Ge=(Je.prototype.play=function(e,t,n){return s(this,void 0,void 0,function(){var i,s,r,a,c,u,l,h,p,d;return o(this,function(o){switch(o.label){case 0:return[4,$.instance.getRes(e,this.coreViewId)];case 1:if(i=o.sent(),s=new cc.Node,(r=s.addComponent(sp.Skeleton)).skeletonData=i.obj,r.loop=n&&n.isLoop,r.premultipliedAlpha=!1,p=h=l=u=c=a=null,n&&(n&&n.startCallback&&(a=n.startCallback),n&&n.interruptCallback&&(c=n.interruptCallback),n&&n.endCallback&&(u=n.endCallback),n&&n.disposeCallback&&(l=n.disposeCallback),n&&n.completeCallback&&(h=n.completeCallback),n&&n.eventCallback&&(p=n.eventCallback)),n&&n.vec2&&(s.x=n.vec2.x,s.y=n.vec2.y),n&&n.name&&(r.animation=n.name),r.setStartListener(function(){a&&a(r)}),r.setInterruptListener(function(){c&&c(r)}),r.setEndListener(function(){u&&u(r)}),r.setDisposeListener(function(){l&&l(r)}),r.setCompleteListener(function(){h&&h(r)}),r.setEventListener(function(){p&&p(r)}),t&&s&&t.addChild(s),n&&n.loadOver&&n.loadOver(s,r),n&&n.playList&&n.playList.length)for(d=0;d<n.playList.length;d++)r.addAnimation(d+1,n.playList[d].name,n.playList[d].isLoop);return[2,s]}})})},Je.prototype.playBinNode=function(e,t){e.name=t.name,e.loop=t&&t.isLoop,e.premultipliedAlpha=!1;var n=null,i=null,s=null,o=null,r=null,a=null;if(t&&(t&&t.startCallback&&(n=t.startCallback),t&&t.interruptCallback&&(i=t.interruptCallback),t&&t.endCallback&&(s=t.endCallback),t&&t.disposeCallback&&(o=t.disposeCallback),t&&t.completeCallback&&(r=t.completeCallback),t&&t.eventCallback&&(a=t.eventCallback)),t&&t.name&&(e.animation=t.name),e.setStartListener(function(){n&&n(e)}),e.setInterruptListener(function(){i&&i(e)}),e.setEndListener(function(){s&&s(e)}),e.setDisposeListener(function(){o&&o(e)}),e.setCompleteListener(function(){r&&r(e)}),e.setEventListener(function(){a&&a(e)}),t&&t.playList&&t.playList.length)for(var c=0;c<t.playList.length;c++)e.addAnimation(c+1,t.playList[c].name,t.playList[c].isLoop)},Je);function Je(e){this.coreViewId=e}var ze,Ke=(n(Qe,ze=cc.Component),Qe.prototype.coreOnEventFun=function(){var e=this.__proto__.classId;if(e){var t=W.instance.getEventContrast(e);if(t)for(var n=0;n<t.length;n++)te.instance.onDescriptor(t[n].eventName,this,this.coreNodeId,t[n].funName)}},Qe.prototype.coreOnModule=function(){var e=this.__proto__.classId;if(e){var t=W.instance.getModuleContrast(e);if(t)for(var n=0;n<t.length;n++)t[n].obj==He?this[t[n].property]=new He(this.coreNodeId):t[n].obj==Ye?this[t[n].property]=new Ye(this.coreNodeId):t[n].obj==je?(this.coreTimerModule=new je,this[t[n].property]=this.coreTimerModule):t[n].obj==Ge?this[t[n].property]=new Ge(this.coreNodeId):(p("@ComponentLogic\uff1a\u6ce8\u518c\u7684\u6a21\u5757\u65e0\u6cd5\u8bc6\u522b"),d(t[n].obj))}},Qe.prototype.coreOnPushFun=function(){var e=this.__proto__.classId;if(e){var t=W.instance.getNetPushContrast(e);if(t)for(var n=0;n<t.length;n++)ke.instance.on(t[n].uri,this,this.coreNodeId,t[n].funName)}},Qe.prototype.coreOnCodeFun=function(){var e=this.__proto__.classId;if(e){var t=W.instance.getCodeContrast(e);if(t)for(var n=0;n<t.length;n++)Ve.instance.on(t[n].code,this,this.coreNodeId,t[n].funName)}},Qe.prototype.coreOnInstance=function(){var e=this.__proto__.classId;if(e){var t=W.instance.getInstanceContrast(e);if(t)for(var n=0;n<t.length;n++){var i=new t[n].class;i.destructor&&i.coreGetInstanceId?(this[t[n].property]=i,this.coreInstanceList.push(i)):p("@ComponentLogic\uff1a\u6ce8\u518c\u7684\u5b9e\u4f8b\u6ca1\u6709\u7ee7\u627f\u4e8eCore.BaseLogic")}}},Qe.prototype.coreOnModel=function(e,t,n){var i=e.watch(t,n),s=this.coreGetModelHandle(e);return s||(s={model:e,watchHandles:[]},this.coreMdHandles.push(s)),s.watchHandles.push(i),i},Qe.prototype.coreGetModelHandle=function(e){for(var t=this.coreMdHandles.length,n=0;n<t;n++){var i=this.coreMdHandles[n];if(i.model===e)return i}return null},Qe.prototype.coreOnLoad=function(){},Qe.prototype.coreStart=function(){},Qe.prototype.coreUpdate=function(e){},Qe.prototype.coreLateUpdate=function(){},Qe.prototype.coreOnEnable=function(){},Qe.prototype.coreOnDisable=function(){},Qe.prototype.coreOnDestroy=function(){},Qe.prototype.coreSetNodeId=function(e){this.coreNodeId=e},Qe.prototype.coreGetNodeId=function(){return this.coreNodeId},Qe.prototype.onLoad=function(){null==this.coreNodeId&&(this.coreNodeId=this.node.name+"_"+S.nodeLogicNum++),this.coreOnEventFun(),this.coreOnModule(),this.coreOnInstance(),this.coreOnCodeFun(),this.coreOnPushFun(),this.coreOnLoad()},Qe.prototype.start=function(){this.coreStart()},Qe.prototype.update=function(e){this.coreUpdate(e)},Qe.prototype.lateUpdate=function(){this.coreLateUpdate()},Qe.prototype.onDestroy=function(){this.coreTimerModule&&this.coreTimerModule.clearAll();for(var e=0;e<this.coreInstanceList.length;e++)this.coreInstanceList[e].destructor&&(this.coreInstanceList[e].destructor(),this.coreInstanceList[e]=null);te.instance.offDescriptor(this.coreNodeId),ke.instance.off(this.coreNodeId),Ve.instance.off(this.coreNodeId);var t=null,n=[];for(e=0;e<this.coreMdHandles.length;e++)if(t=this.coreMdHandles[e].model){n=this.coreMdHandles[e].watchHandles;for(var i=0;i<n.length;i++)t.unwatch(n[i])}this.coreOnDestroy(),$.instance.releaseViewRes(this.coreNodeId)},Qe.prototype.onEnable=function(){this.coreOnEnable()},Qe.prototype.onDisable=function(){this.coreOnDisable()},Qe);function Qe(){var e=ze.call(this)||this;return e.coreNodeId=null,e.coreTimerModule=null,e.coreMdHandles=[],e.coreInstanceList=[],e}var Xe,Ze=(n($e,Xe=Ke),$e.prototype.coreOpenViewShield=function(){this.node.on(cc.Node.EventType.TOUCH_END,this.coreShieldTouchCallBack,this)},$e.prototype.coreCloseViewShield=function(){this.node.off(cc.Node.EventType.TOUCH_END,this.coreShieldTouchCallBack,this)},$e.prototype.coreShieldTouchCallBack=function(e){},$e.prototype.init=function(e){},$e.prototype.coreCloseView=function(){Te.instance.closeView(this.node.name)},$e);function $e(){var e=Xe.call(this)||this;return e.style=0,e}var et=(Object.defineProperty(tt,"instance",{get:function(){return null==this._instance&&(this._instance=new tt),this._instance},enumerable:!0,configurable:!0}),tt.prototype.setUrl=function(e){this.url=e},tt.prototype.send=function(e,t,n){var i=this;return new Promise(function(s,o){if(!i.url)return p("@HttpRequest\uff1a\u6ca1\u6709\u8bbe\u7f6eHTTP\u8bf7\u6c42\u7684\u6839\u5730\u5740"),void o();var a=new XMLHttpRequest;if(a.onreadystatechange=function(){if(4==a.readyState){if(clearTimeout(i.timeoutId),Te.instance.closeShieldView(),200==a.status){var e=void 0;try{e=JSON.parse(a.responseText)}catch(e){return p("@HttpRequest\uff1a\u6536\u5230\u7684\u540e\u7aef\u6570\u636e\u4e0d\u662fjson\u683c\u5f0f "+a.responseText),void o()}c.debugType==r.DEBUG_TYPE_1?S.isNative?cc.log("http <== ",JSON.stringify(e)):cc.log("http %c <== ","color:green;background-color:rgba(167, 167, 167, 0.2)",e):d("@HttpRequest\uff1a\u670d\u52a1\u5668\u8fd4\u56de\u6570\u636e "+a.responseText);var t=parseInt(e.code);if(t==oe.CORE_ERROR_CODE_NONE)return void s(e.data);Ve.instance.checkCode(t)}else{if(0==a.status)return void Ve.instance.checkCode(oe.CORE_NOT_NET);Ve.instance.checkCode(a.status)}o()}},"GET"==n)a.open(n,i.url+t+"?"+e,!0),a.setRequestHeader("Content-Type","application/json;charset=UTF-8"),a.send(),c.debugType==r.DEBUG_TYPE_1?cc.log("http get %c ==> ","color:red;background-color:rgba(167, 167, 167, 0.2)",i.url+t+"?"+e):d("@HttpRequest\uff1a\u53d1\u9001GET\u8bf7\u6c42 "+i.url+t+"?"+e);else{if("POST"!=n)return p("@HttpRequest\uff1aHTTP\u8bf7\u6c42\u4f20\u5165\u7684\u8bf7\u6c42\u7c7b\u578b\u9519\u8bef\uff01\u8bf7\u68c0\u67e5\uff01\uff08\u8bf7\u4f20\u5165 GET \u6216\u8005 POST\uff09"),void o();a.open(n,i.url+t,!0),a.setRequestHeader("Content-Type","application/json;charset=UTF-8"),a.send(e),c.debugType==r.DEBUG_TYPE_1?S.isNative?cc.log("http ==> ",e):(cc.log("http post %c ==> ","color:red;background-color:rgba(167, 167, 167, 0.2)",i.url+t),cc.log(JSON.parse(e))):d("@HttpRequest\uff1a\u53d1\u9001POST\u8bf7\u6c42 "+i.url+t+" "+e)}Te.instance.openShieldView(),i.timeoutId=setTimeout(function(){Te.instance.closeShieldView(),p("@HttpRequest\uff1ahttp\u8bf7\u6c42\u8d85\u65f6"),o()},5e3)})},tt.prototype.loadJS=function(e){return new Promise(function(t){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==n.readyState){if(200<=n.status&&n.status<=207||0==n.status)return void t(n.responseText);t(null)}},n.open("GET",e,!0),n.send()})},tt._instance=null,tt);function tt(){this.timeoutId=null,this.url=null}var nt=(Object.defineProperty(it,"instance",{get:function(){return null==this._instance&&(this._instance=new it),this._instance},enumerable:!0,configurable:!0}),it.prototype.send=function(e,t){var n=this;if(cc.sys.isNative)return new Promise(function(i){var s={uri:e.uri,data:e.data,action:"request",outTime:t,callback:i};n.request=s,n.upMessage(s)});p("@ShellRequest\uff1a\u5916\u58f3\u4ea4\u4e92\u9700\u8981\u5728Native\u73af\u5883\u4e2d\u8fdb\u884c")},it.prototype.upMessage=function(e){var t=this;this.logSend({uri:e.uri,data:e.data,action:"request"}),e.outTime&&0<e.outTime&&(this.outTimeId=setTimeout(function(){d("@ShellRequest\uff1a\u53d1\u751f\u534f\u8bae\u8d85\u65f6\u60c5\u51b5\uff08"+e.uri+"\uff09"),t.downMessage(e.uri,null),clearTimeout(t.outTimeId),t.outTimeId=null},e.outTime)),cc.sys.isNative&&(cc.sys.OS_IOS==cc.sys.os?jsb.reflection.callStaticMethod("XXGBridge","send:",JSON.stringify(e)):cc.sys.OS_ANDROID==cc.sys.os&&jsb.reflection.callStaticMethod("org/cocos2dx/javascript/xxg/XXGBridge","Send","(Ljava/lang/String;)V",JSON.stringify(e)))},it.prototype.receive=function(e){var t=e.uri,n=e.action;this.logReceive(e),this.outTimeId&&(clearTimeout(this.outTimeId),this.outTimeId=null),t||p("@ShellRequest\uff1a\u6536\u5230\u7684\u534f\u8bae\u6ca1\u6709uri\u534f\u8bae\u6807\u8bc6"),n||p("@ShellRequest\uff1a\u6536\u5230\u7684\u534f\u8bae\u6ca1\u6709action\u884c\u4e3a"),n==r.AGREEMENT_TYPE_PUSH?ke.instance.setPushData(t,e.data):n==r.AGREEMENT_TYPE_REQUEST&&this.downMessage(t,e.data)},it.prototype.downMessage=function(e,t){this.request&&(this.request.uri=e)&&this.request.callback&&(this.request.callback(t),this.request=null)},it.prototype.logSend=function(e){c.debugType==r.DEBUG_TYPE_1?S.isNative&&cc.log("ShellRequest ==> ",JSON.stringify(e)):d("@ShellRequest\uff1a\u53d1\u9001\u6d88\u606f "+JSON.stringify(e))},it.prototype.logReceive=function(e){c.debugType==r.DEBUG_TYPE_1?S.isNative&&cc.log("ShellRequest <== ",JSON.stringify(e)):d("@ShellRequest\uff1a\u6536\u5230\u6d88\u606f "+JSON.stringify(e))},it._instance=null,it);function it(){var e=this;this.request=null,this.outTimeId=null,cc.sys.isNative&&(window.coreNativeHandler=function(t){e.receive(JSON.parse(t))})}var st=(Object.defineProperty(ot,"instance",{get:function(){return null==this._instance&&(this._instance=new ot),this._instance},enumerable:!0,configurable:!0}),ot.prototype.open=function(e){return s(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return this.webSocketUrl=e,[4,this.build()];case 1:return[2,t.sent()]}})})},ot.prototype.build=function(){var e=this;return new Promise(function(t){d("@WebSocket\uff1a\u53d1\u8d77\u8fde\u63a5---\x3e>>"+e.webSocketUrl);try{e.webSocket=new WebSocket(e.webSocketUrl),e.webSocket.binaryType="arraybuffer"}catch(n){return p("@WebSocket\uff1a\u6253\u5f00\u8fde\u63a5\u51fa\u9519 "+n),void(e.isOpen?te.instance.event(ie.CORE_WS_RECONNECTION_FAILUE):t(!1))}e.webSocket.onopen=function(n){e.isOpen=!0,d("@WebSocket\uff1a<<<---\u8fde\u63a5\u6210\u529f"),t(!0)},e.webSocket.onerror=function(e){p("@WebSocket\uff1a\u53d1\u751f\u9519\u8bef")},e.webSocket.onmessage=function(t){var n=t.data,i=ae.unpack(n);e.receive(i)},e.webSocket.onclose=function(n){d("@WebSocket\uff1a\u8fde\u63a5\u5173\u95ed"),cc.sys.isNative?console.error(JSON.stringify(n)):console.error(n),e.isOpen?(Te.instance.closeShieldView(),e.code==oe.CORE_ERROR_CODE_NONE?(d("@WebSocket\uff1a\u8fde\u63a5\u5f02\u5e38\u5173\u95ed\u91cd\u65b0\u53d1\u8d77\u8fde\u63a5"),S.isNet&&te.instance.event(ie.CORE_WS_DISCONNECT),setTimeout(function(){e.restartWebSocket()},2e3)):e.close()):t(!1)}})},ot.prototype.restartWebSocket=function(){return s(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return this.reconnectionNum++,3<this.reconnectionNum?(S.isNet&&te.instance.event(ie.CORE_WS_RECONNECTION_FAILUE),[2]):[4,this.build()];case 1:return e.sent()?(S.isNet&&te.instance.event(ie.CORE_WS_RECONNECTION_SUCCES),this.reconnectionNum=0,this.cleanRequestQueue()):this.restartWebSocket(),[2]}})})},ot.prototype.send=function(e,t,n){var i=this;return this.isOpen?ae.isProtocol()?new Promise(function(s){var o={msg:t,name:e,callback:s,tag:n};i.requestQueue.push(o),1<i.requestQueue.length?d("@WebSocket\uff1a\u5f53\u524d\u6709\u672a\u5b8c\u6210\u7684\u901a\u8baf\uff0c\u628a\u5f53\u524d\u534f\u8bae\u653e\u5165\u961f\u5217"):(n||Te.instance.openShieldView(!0),i.upMessage(o))}):void p("@WebSockets\uff1aprotocol\u6587\u4ef6\u4e0d\u5b58\u5728\u65e0\u6cd5\u4f7f\u7528Protobuf"):(te.instance.event(ie.CORE_WS_NOT_CONNECTION),void p("@WebSocket\uff1a\u8fde\u63a5\u6ca1\u6709\u5efa\u7acb"))},ot.prototype.sendUDP=function(e,t){if(!this.isOpen)return te.instance.event(ie.CORE_WS_NOT_CONNECTION),void p("@WebSocket\uff1a\u8fde\u63a5\u6ca1\u6709\u5efa\u7acb");var n;ae.isProtocol()?(this.logSend({uri:e,msg:t,action:"udp"}),n=ae.pack(e,t,"udp"),this.webSocket.send(n)):p("@WebSockets\uff1aprotocol\u6587\u4ef6\u4e0d\u5b58\u5728\u65e0\u6cd5\u4f7f\u7528Protobuf")},ot.prototype.receive=function(e){this.code=e.code;var t=e.action,n=e.uri;this.logReceive(e),this.code==oe.CORE_ERROR_CODE_NONE?(n||p("@WebSocket\uff1a\u540e\u53f0\u53d1\u9001\u7684\u534f\u8bae\u6ca1\u6709uri\u534f\u8bae\u6807\u8bc6"),t||p("@WebSocket\uff1a\u540e\u53f0\u53d1\u9001\u7684\u534f\u8bae\u6ca1\u6709action\u884c\u4e3a"),t==r.AGREEMENT_TYPE_PUSH?ke.instance.setPushData(n,e.data):t==r.AGREEMENT_TYPE_REQUEST&&this.downMessage(e.data)):(Te.instance.closeShieldView(),t==r.AGREEMENT_TYPE_REQUEST&&this.downMessage(null),Ve.instance.checkCode(this.code))},ot.prototype.upMessage=function(e){e.tag||Te.instance.openShieldView(!0),this.logSend({uri:e.name,data:e.msg,action:"request"});var t=ae.pack(e.name,e.msg,"request");this.webSocket.send(t)},ot.prototype.downMessage=function(e){var t=this.requestQueue[0];t&&(t.callback&&t.callback(e),this.requestQueue.splice(0,1)),this.retrieveRequestQueue()&&Te.instance.closeShieldView()},ot.prototype.close=function(){this.isOpen&&this.webSocket&&(this.webSocket.onerror=null,this.webSocket.onclose=null,this.webSocket.close(),this.webSocket=null,this.isOpen=!1,this.requestQueue=[],this.reconnectionNum=0,d("@WebSocket\uff1a\b\u5ba2\u6237\u7aef\u5df2\u7ecf\u5173\u95ed\u8fde\u63a5"))},ot.prototype.retrieveRequestQueue=function(){if(this.requestQueue.length){var e=this.requestQueue[0];return this.upMessage(e),!1}return!0},ot.prototype.cleanRequestQueue=function(){this.requestQueue=[]},ot.prototype.logSend=function(e){c.debugType==r.DEBUG_TYPE_1?S.isNative?cc.log("webSocket ==> ",JSON.stringify(e)):cc.log("webSocket %c ==> ","color:red;background-color:rgba(167, 167, 167, 0.2)",e):d("@WebSocket\uff1a\u53d1\u9001\u6d88\u606f "+JSON.stringify(e))},ot.prototype.logReceive=function(e){c.debugType==r.DEBUG_TYPE_1?S.isNative?cc.log("webSocket <== ",JSON.stringify(e)):cc.log("webSocket %c <== ","color:green;background-color:rgba(167, 167, 167, 0.2)",e):d("@WebSocket\uff1a\u6536\u5230\u6d88\u606f "+JSON.stringify(e))},ot._instance=null,ot);function ot(){this.webSocketUrl=null,this.requestQueue=[],this.isOpen=!1,this.reconnectionNum=0,this.code=oe.CORE_ERROR_CODE_NONE}var rt=Te.instance,at=te.instance,ct=et.instance,ut=$.instance,lt=we.instance,ht=st.instance,pt=nt.instance;e.ApplicationLogic=Pe,e.Audio=He,e.Base64=K,e.BaseConfig=c,e.BaseLogic=Be,e.BaseModel=D,e.BaseTableData=U,e.CommonFun=q,e.ComponentLogic=Ke,e.CoreCodeMap=oe,e.CoreEventMap=ie,e.CreateFun=x,e.EUpdateState=g,e.EViewStyle={NO_FULL:0,FULL:1},e.EventManager=te,e.HotUpdate=_,e.HttpRequest=et,e.Res=Ye,e.ResManager=$,e.ShellRequest=nt,e.Skeleton=Ge,e.StaticConfig=r,e.SystemConfig=S,e.Timer=je,e.ViewAdaptation=A,e.ViewLogic=Ze,e.ViewManager=Te,e.WebSockets=st,e.audioManager=lt,e.code=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t,n,i){t.classId||(t.classId=z());for(var s=0;s<e.length;s++)W.instance.onCode(t.classId,e[s],n);return i}},e.error=function(e){l.instance.error(e)},e.event=function(e){return function(t,n,i){return t.classId||(t.classId=z()),W.instance.onEvent(t.classId,e,n),i}},e.eventManager=at,e.field=function(e,t){delete e[t]&&Object.defineProperty(e.constructor.prototype,t,{get:function(){return this["_"+t]},set:function(n){var i=this["_"+t];this["_"+t]=n,e.touch.call(this,t,n,i)},enumerable:!0,configurable:!0})},e.httpRequest=ct,e.instance=function(e){return function(t,n,i){return t.classId||(t.classId=z()),W.instance.onInstance(t.classId,e,n),i}},e.log=function(e){l.instance.log(e)},e.module=function(e){return function(t,n,i){return t.classId||(t.classId=z()),W.instance.onModule(t.classId,e,n),i}},e.netPush=function(e){return function(t,n,i){return t.classId||(t.classId=z()),W.instance.onNetPush(t.classId,e,n),i}},e.resManager=ut,e.shellRequest=pt,e.viewManager=rt,e.webSockets=ht,Object.defineProperty(e,"__esModule",{value:!0})});